<!DOCTYPE html>
<html lang="en" xmlns:v-bind="http://www.w3.org/1999/xhtml" xmlns:v-on="http://www.w3.org/1999/xhtml">
<head>
    <meta charset="UTF-8">
    <title>brand Master</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type="text/css">
        /*去除默认样式*/
        * {
            padding: 0;
            margin: 0;
        }

        /*解决高度塌陷*/
        .clearfix:before,
        .clearfix:after {
            content: '';
            display: table;
            clear: both;
        }

        [v-cloak] {
            display: none;
        }

        .header {
            margin: 0 auto;
            background: #bfa;
            width: 90%;
        }

        #ddiv {
            background-color: white;
            padding: 10px;
        }

        #hdiv > h3 {
            text-align: center;
        }

        .table {
            /*border: 1px solid black;*/
            margin: 50px auto;
            width: 90%;
            line-height: 2em;
            text-align: center;
            border: 1px black dashed;
        }
    </style>
    <script src="https://unpkg.com/vue/dist/vue.js"></script>
    <script>
        window.onload = function () {
            //全局过滤器
            Vue.filter('dateFormat', function (dataStr, pattern = '') {
                let dt = new Date(dataStr)
                let y = dt.getFullYear()
                let m = dt.getMonth() + 1
                let d = dt.getDate()
                if (pattern == 'yyyy-mm-dd') {
                    return `${y}-${m}-${d}`
                } else {
                    return dataStr
                }
            });
            //过滤器
            // Vue.filter('carFormat', function (name) {
            //     return name.replace(/86/g, '')
            // });
            //编写Vue相关代码
            //自定义全局按键修饰符
            Vue.config.keyCodes.f2 = 113
            //自定义指令 指令名 相关函数
            Vue.directive('focus', {
                bind: function () {//绑定时执行，只能执行一次
                    //绑定完指令的时候，还没有插入到DOM中去，
                    // 一个元素只有插入到DOM中去才能调用方法

                },
                inserted: (el) => {//元素插入到DOM中的时候执行
                    el.focus()
                },
                updated: function () {//VNode更新时执行，可能触发多次

                }
            })
            Vue.directive('color', {
                // 样式相关的操作放在bind中执行
                bind: function (el, binding) {
                    // console.log(binding.value);
                    // el.style.color = 'red'
                    el.style.color = binding.value
                }
            })

            var vm = new Vue({
                    el: '#app',
                    data: {
                        msg: "XBB",
                        index: '',
                        carname: '',
                        keywords: '',
                        carcolor: '#f1a1f1',
                        carlist: [
                            {index: 1, carname: "奔驰", addtime: new Date()},
                            {index: 2, carname: "宝马", addtime: new Date()},
                            {index: 3, carname: "AE86", addtime: new Date()}
                        ]
                    },
                    methods: {
                        add() {
                            let car = {index: this.index, carname: this.carname, addtime: new Date()}
                            this.carlist.push(car)
                            this.index = this.carname = ''
                        },
                        del(index) {
                            //findIndex 与 some 类似
                            // return true 时 返回index
                            // let i = this.carlist.findIndex(item=>{
                            //     if (item.index == index) return true;
                            // })
                            // this.carlist.splice(i, 1);
                            //forEach
                            this.carlist.forEach((item, i) => {
                                if (item.index === index) {
                                    this.carlist.splice(i, 1);
                                }
                            })

                        },
                        search(keywords) {
                            // let newList = []
                            // this.carlist.forEach((item) => {
                            //     if (item.carname.indexOf(keywords) != -1) {
                            //         newList.push(item);
                            //     }
                            // })
                            // return newList
                            return this.carlist.filter(item => {
                                if (item.carname.includes(keywords)) return item
                            })
                        }
                    },
                    filters: {
                        //定义私有过滤器 过滤器两个条件 过滤器名称 和处理函数
                        dateFormat: function (dataStr, pattern = '') {
                            let dt = new Date(dataStr)
                            let y = dt.getFullYear()
                            let m = (dt.getMonth() + 1).toString().padStart(2, '0')
                            let d = (dt.getDate()).toString().padStart(2, '0')
                            if (pattern == 'yyyy-mm-dd') {
                                return `${y}-${m}-${d}`
                            } else {
                                return dataStr
                            }
                        }
                    },
                    //私有自定义指令
                    directives: {
                        //使用简写模式 意味着把这个function 同时写到bind和update中去
                        'fontsize': function (el, binding) {
                            el.style.fontSize = parseInt(binding.value) + 'px'
                        },
                        'fontstyle': function (el, binding) {
                            el.style.fontStyle = binding.value
                        }
                    },
                    // beforeCreate() {
                    //     //在beforeCreate生命周期函数执行的时候，
                    //     //data和el和methods都还没有加载
                    // },
                    // created() {
                    //     // console.log(this.methods.add);
                    // },
                    // beforeMount() {
                    //     //模板已经在内存中编辑完成了，但是尚未把模板渲染到页面中
                    //     //挂载 页面还是旧的 及 模板字符串
                    // },
                    // mounted() {
                    //     //将真实的替换到浏览器的页面中去
                    // },
                    // beforeUpdate() {
                    //     //数据被更新才触发
                    //     //页面中显示的数据还是旧的，此时data数据采是最新的
                    //     //但页面尚未和最新的数据保持同步
                    // },
                    // updeted() {
                    //     //页面和数据已经同步，都是更新后的
                    // }
                }
                )
            ;
        }
        ;
    </script>
</head>
<body>
<div id="app">

    <div class="header">
        <div id="hdiv">
            <h3>添加信息</h3>
        </div>
        <div id="ddiv">
            <label>
                序号:<input type="text" v-model="index">
            </label>
            <label>
                品牌:<input type="text" v-model="carname" @keyup.f2="add">
                <!--f2是自定义的键盘修饰符-->
            </label>
            <input type="button" id="btn" value="提交" @click="add">
            <label>
                搜索名称关键字:<input type="text" v-model="keywords" v-focus v-color="carcolor">
            </label>
        </div>
    </div>

    <table v-cloak :class="['table']">
        <thead>
        <tr>
            <th>序号</th>
            <th>品牌界面</th>
            <th>添加时间</th>
            <th>操作</th>
        </tr>
        </thead>
        <tbody>
        <tr v-for="item in search(keywords)" :key="item.index">
            <td>{{item.index}}</td>
            <td>{{item.carname}}</td>
            <td v-fontstyle="'italic'">{{item.addtime | dateFormat('yyyy-mm-dd')}}</td>
            <td>
                <a href="" @click.prevent="del(item.index)">删除</a>
            </td>
        </tr>
        </tbody>

    </table>
    <!--<p v-fontsize="'30'">This is a p tag.</p>-->
</div>
</body>
</html>